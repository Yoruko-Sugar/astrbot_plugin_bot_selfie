# AstrBot Selfie - 基于豆包api的bot自拍插件

基于每日穿搭生成Bot自拍照片的插件，支持使用命令和自然语言理解调用豆包API生成图像。

## 声明

- 本插件完全使用Cursor生成，若生成敏感信息概不负责，请注意提示词的使用

## 功能特性

- 支持使用 `/自拍` 命令生成Bot自拍
- 支持自然语言理解，当用户提到"自拍"、"来张自拍"等关键词时自动生成
- 自动从 `astrbot_plugin_life_scheduler` 插件获取今日穿搭作为提示词（强关联astrbot_plugin_life_scheduler插件）
- 支持本地存储Bot人设参考图
- 支持豆包API轮询池
- 支持配置化：API基础URL、图生图分辨率等
- 内置API调用限流机制

## 安装

1. 将插件目录 `astrbot_plugin_bot_selfie` 复制到 `AstrBot/data/plugins` 目录
2. 安装依赖：`pip install -r requirements.txt`
3. 重启 AstrBot 服务

## 配置

在 AstrBot 管理界面中配置插件参数：

### API设置
- **提供商ID**：AstrBot中配置的豆包API提供商ID
- **API类型**：固定为 `doubao`
- **API Base URL**：豆包API的基础URL，默认为 `https://ark.cn-beijing.volces.com/api/v3`
- **API密钥**：豆包API的密钥列表，支持轮询使用

### 生成设置
- **图像分辨率**：生成图像的分辨率，可选 `512x512`、`1024x1024`、`2048x2048`
- **图像比例**：生成图像的宽高比，可选 `1:1`、`4:3`、`16:9`、`9:16`
- **模型名称**：豆包图像生成模型名称，默认为 `ep-20240715145732-f442p`

### 人设设置
- **人设参考图路径**：本地存储的Bot人设参考图路径
- **启用自动穿搭**：是否自动从life_scheduler插件获取今日穿搭

### 限流设置
- **启用限流**：是否启用API调用限流
- **最大请求数**：单位时间内的最大请求数
- **时间窗口**：限流的时间窗口（秒）

## 使用方法

### 命令方式
- 发送 `/自拍` 命令，插件会自动获取今日穿搭并生成自拍
- 支持别名：`自拍`、`selfie`

### 自然语言方式
- 发送包含"自拍"、"拍张照片"、"照张相"等关键词的消息
- 例如："来张自拍"

## 依赖

- `aiohttp`：用于异步HTTP请求
- `astrbot_plugin_life_scheduler`：用于获取今日穿搭

## 注意事项

1. 请确保已正确配置豆包API密钥和模型信息
2. 请确保 `astrbot_plugin_life_scheduler` 插件已安装并正常运行
3. 人设参考图请使用清晰、正面的图像，以获得更好的生成效果
4. API调用可能会产生费用，请合理使用

## 故障排除

- **无法获取今日穿搭**：检查 `astrbot_plugin_life_scheduler` 插件是否已安装并正常运行
- **API调用失败**：检查API密钥是否正确，网络连接是否正常
- **生成的图像不符合预期**：调整提示词或更换人设参考图






